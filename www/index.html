<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <link rel="shortcut icon" href="assets/vendore/img/max.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="style.css" rel="stylesheet">
    <link href="assets/vendore/animate.css" rel="stylesheet">
    <script src="https://unpkg.com/siriwave/dist/siriwave.umd.min.js"></script>
    <title>MAX</title>
</head>
<body>

    <!-- Audio element for site sound -->
    <audio id="siteSound" preload="auto">
        <source src="assets/www_assets_audio_start_sound (1).mp3" type="audio/mpeg">
    </audio>
   
    <section id="Oval" class="mb-4">
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10">
                <div class="d-flex flex-column align-items-center justify-content-center" style="position: relative;">
                    <div id="JarvisWood">
                        <div class="square">
                            <span class="circle"></span>
                            <span class="circle"></span>
                            <span class="circle"></span>
                        </div>
                    </div>
                    <h5 id="globeText" class=" text text-light">What's on your mind?</h5>
                    
                    <!-- Input Field with Icons -->
                    <div class="input-container mt-4">
                        <div class="input-wrapper">
                            <input type="text" id="maxInput" class="max-input" placeholder="Type here..." autocomplete="off">
                            <div class="input-icons">
                                <button class="icon-btn" id="micBtn" title="Voice Input">
                                    <i class="bi bi-mic"></i>
                                </button>
                                <button class="icon-btn" id="chatBtn" title="Chat">
                                    <i class="bi bi-chat-dots"></i>
                                </button>
                                <button class="icon-btn" id="settingsBtn" title="Settings">
                                    <i class="bi bi-gear"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-1"></div>
        </div>
    </section>
    
    <!-- SiriWave Section -->
    <section id="SiriWave" class="mt-5" style="display: none;">
        <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-10">
                <div class="d-flex flex-column align-items-center justify-content-center">
                    <p class="text-center text-light mb-4 siri-message">Listening...</p>
                    <div id="siri-container"></div>
                </div>
            </div>
            <div class="col-md-1"></div>
        </div>
    </section>
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="assets/vendore/jquery.lettering.js"></script>
    <script src="assets/vendore/jquery.fittext.js"></script>
    <script src="http://jschr.github.io/textillate/jquery.textillate.js"></script>
    <script src="main.js"></script>
    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
    <script>src="/eel.js"</script>
    
    <!-- SiriWave Initialization -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let siriWave = null;
            let isListening = false;
            
            // Get mic button and SiriWave section
            const micBtn = document.getElementById('micBtn');
            const siriWaveSection = document.getElementById('SiriWave');
            
            // Add click event listener to mic button
            micBtn.addEventListener('click', function() {
                // Play sound when mic is clicked
                const siteSound = document.getElementById('siteSound');
                if (siteSound) {
                    siteSound.currentTime = 0; // Reset to beginning
                    siteSound.play().catch(error => {
                        console.log('Failed to play mic sound:', error);
                    });
                }
                
                if (!isListening) {
                    // Start listening - show SiriWave section
                    siriWaveSection.style.display = 'block';
                    isListening = true;
                    
                    // Initialize SiriWave after a short delay to ensure container is visible
                    setTimeout(() => {
                        siriWave = new SiriWave({
                            container: document.getElementById("siri-container"),
                            width: window.innerWidth * 0.6,
                            height: 200,
                            style: "ios9",
                            autostart: true,
                            amplitude: 1.5,
                            speed: 0.2
                        });
                    }, 100);
                    
                    // Update mic button appearance
                    this.style.color = '#00dff3';
                    this.style.boxShadow = '0 0 20px rgba(0, 223, 243, 0.6)';
                    
                    // Adjust input field for SiriWave
                    const inputWrapper = document.querySelector('.input-wrapper');
                    const inputIcons = document.querySelector('.input-icons');
                    const maxInput = document.querySelector('.max-input');
                    
                    inputWrapper.style.padding = '15px 40px';
                    inputIcons.style.gap = '15px';
                    inputIcons.style.paddingRight = '15px';
                    inputIcons.style.marginLeft = '-10px';
                    maxInput.style.marginRight = '55px';
                    
                } else {
                    // Stop listening - hide SiriWave section
                    siriWaveSection.style.display = 'none';
                    isListening = false;
                    
                    // Stop SiriWave animation
                    if (siriWave) {
                        siriWave.stop();
                        siriWave = null;
                    }
                    
                    // Reset mic button appearance
                    this.style.color = 'rgba(255, 255, 255, 0.7)';
                    this.style.boxShadow = 'none';
                    
                    // Reset input field to original state
                    const inputWrapper = document.querySelector('.input-wrapper');
                    const inputIcons = document.querySelector('.input-icons');
                    const maxInput = document.querySelector('.max-input');
                    
                    inputWrapper.style.padding = '15px 35px';
                    inputIcons.style.gap = '18px';
                    inputIcons.style.paddingRight = '10px';
                    inputIcons.style.marginLeft = '-15px';
                    maxInput.style.marginRight = '50px';
                }
            });
            
            // Handle window resize
            window.addEventListener('resize', function() {
                if (siriWave) {
                    siriWave.width = window.innerWidth * 0.6;
                }
            });
        });
    </script>

    <!-- Audio autoplay functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const siteSound = document.getElementById('siteSound');
            let soundPlayed = false;
            
            // Text-to-speech functionality
            async function speakText(text) {
                try {
                    const result = await eel.speak_text(text)();
                    console.log('TTS Result:', result);
                    return result;
                } catch (error) {
                    console.error('TTS Error:', error);
                    return {status: "error", message: error.toString()};
                }
            }
            
            // Test TTS when page loads
            setTimeout(() => {
                speakText("Hello, I am Max, your assistant. How can I help you today?");
            }, 2000);
            
            // Function to play sound
            function playSiteSound() {
                if (!soundPlayed && siteSound) {
                    siteSound.play().then(() => {
                        soundPlayed = true;
                        console.log('Site sound played successfully');
                    }).catch(error => {
                        console.log('Autoplay blocked:', error);
                        // Set up fallback for user interaction
                        setupFallbackPlay();
                    });
                }
            }
            
            // Function to set up fallback for user interaction
            function setupFallbackPlay() {
                if (soundPlayed) return;
                
                const playOnInteraction = function() {
                    if (!soundPlayed && siteSound) {
                        siteSound.play().then(() => {
                            soundPlayed = true;
                            console.log('Site sound played on user interaction');
                        }).catch(error => {
                            console.log('Failed to play sound:', error);
                        });
                    }
                    // Remove event listeners after first interaction
                    document.removeEventListener('click', playOnInteraction);
                    document.removeEventListener('keydown', playOnInteraction);
                    document.removeEventListener('touchstart', playOnInteraction);
                };
                
                // Add event listeners for user interaction
                document.addEventListener('click', playOnInteraction);
                document.addEventListener('keydown', playOnInteraction);
                document.addEventListener('touchstart', playOnInteraction);
            }
            
            // Try to play sound on window load
            window.addEventListener('load', function() {
                // Small delay to ensure everything is loaded
                setTimeout(playSiteSound, 100);
            });
            
            // Also try on DOMContentLoaded as backup
            playSiteSound();
        });
    </script>

</body>
</html>
